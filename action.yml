name: "Setup WABT"
description: "Setup WebAssembly Binary Toolkit"
branding:
  icon: download
  color: purple
inputs:
  version:
    description: "Version to Install"
    default: "latest"
runs:
  using: "composite"
  steps:
    - name: Setup WABT
      shell: bash
      run: |
        set -e

        VERSION="${{ inputs.version }}"
        if [ "$VERSION" = 'latest' ]; then
          VERSION=$(gh release view \
          --repo WebAssembly/wabt \
          --json tagName -q .tagName)
        fi
        echo "Version: $VERSION"

        if [ "$RUNNER_OS" = 'Linux' ]; then
          ASSET=".*ubuntu.*\\\\.tar\\\\.gz$"
        elif [ "$RUNNER_OS" = 'macOS' ]; then
          ASSET=".*macos.*\\\\.tar\\\\.gz$"
        elif [ "$RUNNER_OS" = 'Windows' ]; then
          ASSET=".*windows.*\\\\.tar\\\\.gz$"
        else
          exit 1
        fi
        echo "Test: $ASSET"

        ASSET=$(gh release view $VERSION \
        --repo WebAssembly/wabt \
        --json assets -q ".assets[].name | select(test(\"$ASSET\"))")
        echo "Asset: $ASSET"

        mkdir wabt
        gh release download $VERSION \
        --repo WebAssembly/wabt \
        --pattern $ASSET
        -O - \
        | tar -xzC wabt --strip-components=1
        ls wabt/bin
        echo "$(pwd -W 2>/dev/null || pwd)/wabt/bin" >> $GITHUB_PATH
